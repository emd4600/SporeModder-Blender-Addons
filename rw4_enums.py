from .file_io import FileReader, FileWriter
from collections import namedtuple

# intIdentifier, argType, default value, (range)


# D3DBOOLEAN
FALSE = 0
TRUE = 1

# D3DWRAPCOORD
D3DWRAPCOORD_NONE = 0
D3DWRAPCOORD_0 = 1
D3DWRAPCOORD_1 = 2
D3DWRAPCOORD_2 = 4
D3DWRAPCOORD_3 = 8

# D3DTEXTURETRANSFORMFLAGS
D3DTTFF_DISABLE = 0
D3DTTFF_COUNT1 = 1
D3DTTFF_COUNT2 = 2
D3DTTFF_COUNT3 = 3
D3DTTFF_COUNT4 = 4
D3DTTFF_PROJECTED = 256
D3DTTFF_FORCE_DWORD = 0x7fffffff

# D3DTEXTUREADDRESS
D3DTADDRESS_WRAP = 1
D3DTADDRESS_MIRROR = 2
D3DTADDRESS_CLAMP = 3
D3DTADDRESS_BORDER = 4
D3DTADDRESS_MIRRORONCE = 5
D3DTADDRESS_FORCE_DWORD = 0x7fffffff

# D3DTEXTUREFILTERTYPE
D3DTEXF_NONE = 0
D3DTEXF_POINT = 1
D3DTEXF_LINEAR = 2
D3DTEXF_ANISOTROPIC = 3
D3DTEXF_PYRAMIDALQUAD = 6
D3DTEXF_GAUSSIANQUAD = 7
D3DTEXF_CONVOLUTIONMONO = 8
D3DTEXF_FORCE_DWORD = 0x7fffffff

# D3DDECLTYPE
D3DDECLTYPE_FLOAT1 = 0
D3DDECLTYPE_FLOAT2 = 1
D3DDECLTYPE_FLOAT3 = 2
D3DDECLTYPE_FLOAT4 = 3
D3DDECLTYPE_D3DCOLOR = 4
D3DDECLTYPE_UBYTE4 = 5
D3DDECLTYPE_SHORT2 = 6
D3DDECLTYPE_SHORT4 = 7
D3DDECLTYPE_UBYTE4N = 8
D3DDECLTYPE_SHORT2N = 9
D3DDECLTYPE_SHORT4N = 10
D3DDECLTYPE_USHORT2N = 11
D3DDECLTYPE_USHORT4N = 12
D3DDECLTYPE_UDEC3 = 13
D3DDECLTYPE_DEC3N = 14
D3DDECLTYPE_FLOTA16_2 = 15
D3DDECLTYPE_FLOAT16_4 = 16

D3DDECLTYPE_FORMATS = [
    '<f',  # float1
    '<ff',  # float2
    '<fff',  # float3
    '<ffff',  # float4
    '<I',  # D3DCOLOR
    '<BBBB',  # ubyte4
    '<hh',  # short2
    '<hhhh',  # short4
    '<BBBB',  # ubyte4n
    '<hh',  # short2n
    '<hhhh',  # short4n
    '<HH',  # ushort2n
    '<HHHH',  # ushort4n
    # last four are not supported
]

# D3DDECLMETHOD
D3DDECLMETHOD_DEFAULT = 0
D3DDECLMETHOD_PARTIALU = 1
D3DDECLMETHOD_PARTIALV = 2
D3DDECLMETHOD_CROSSUV = 3
D3DDECLMETHOD_UV = 4
D3DDECLMETHOD_LOOKUP = 5
D3DDECLMETHOD_LOOKUPPRESAMPLED = 6

# D3DDECLUSAGE
D3DDECLUSAGE_POSITION = 0
D3DDECLUSAGE_BLENDWEIGHT = 1
D3DDECLUSAGE_BLENDINDICES = 2
D3DDECLUSAGE_NORMAL = 3
D3DDECLUSAGE_PSIZE = 4
D3DDECLUSAGE_TEXCOORD = 5
D3DDECLUSAGE_TANGENT = 6
D3DDECLUSAGE_BINORMAL = 7
D3DDECLUSAGE_TESSFACTOR = 8
D3DDECLUSAGE_POSITIONT = 9
D3DDECLUSAGE_COLOR = 10
D3DDECLUSAGE_FOG = 11
D3DDECLUSAGE_DEPTH = 12
D3DDECLUSAGE_SAMPLE = 13

# D3DPRIMITIVETYPE
D3DPT_POINTLIST = 1
D3DPT_LINELIST = 2
D3DPT_LINESTRIP = 3
D3DPT_TRIANGLELIST = 4
D3DPT_TRIANGLESTRIP = 5
D3DPT_TRIANGLEFAN = 6
D3DPT_FORCE_DWORD = 0x7fffffff

# D3DUSAGE
D3DUSAGE_RENDERTARGET = 0x00000001
D3DUSAGE_DEPTHSTENCIL = 0x00000002
D3DUSAGE_DYNAMIC = 0x00000200
D3DUSAGE_NONSECURE = 0x00800000
D3DUSAGE_AUTOGENMIPMAP = 0x00000400
D3DUSAGE_DMAP = 0x00004000
D3DUSAGE_QUERY_LEGACYBUMPMAP = 0x00008000
D3DUSAGE_QUERY_SRGBREAD = 0x00010000
D3DUSAGE_QUERY_FILTER = 0x00020000
D3DUSAGE_QUERY_SRGBWRITE = 0x00040000
D3DUSAGE_QUERY_POSTPIXELSHADER_BLENDING = 0x00080000
D3DUSAGE_QUERY_VERTEXTEXTURE = 0x00100000
D3DUSAGE_QUERY_WRAPANDMIP = 0x00200000
D3DUSAGE_WRITEONLY = 0x00000008
D3DUSAGE_SOFTWAREPROCESSING = 0x00000010
D3DUSAGE_DONOTCLIP = 0x00000020
D3DUSAGE_POINTS = 0x00000040
D3DUSAGE_RTPATCHES = 0x00000080
D3DUSAGE_NPATCHES = 0x00000100
D3DUSAGE_TEXTAPI = 0x10000000
D3DUSAGE_RESTRICTED_CONTENT = 0x00000800
D3DUSAGE_RESTRICT_SHARED_RESOURCE = 0x00002000
D3DUSAGE_RESTRICT_SHARED_RESOURCE_DRIVER = 0x00001000


def make_four_cc(arg):
    return (ord(arg[3]) << 24) | (ord(arg[2]) << 16) | (ord(arg[1]) << 8) | ord(arg[0])


# D3DFORMAT
D3DFMT_UNKNOWN = 0
D3DFMT_R8G8B8 = 20
D3DFMT_A8R8G8B8 = 21
D3DFMT_X8R8G8B8 = 22
D3DFMT_R5G6B5 = 23
D3DFMT_X1R5G5B5 = 24
D3DFMT_A1R5G5B5 = 25
D3DFMT_A4R4G4B4 = 26
D3DFMT_R3G3B2 = 27
D3DFMT_A8 = 28
D3DFMT_A8R3G3B2 = 29
D3DFMT_X4R4G4B4 = 30
D3DFMT_A2B10G10R10 = 31
D3DFMT_A8B8G8R8 = 32
D3DFMT_X8B8G8R8 = 33
D3DFMT_G16R16 = 34
D3DFMT_A2R10G10B10 = 35
D3DFMT_A16B16G16R16 = 36
D3DFMT_A8P8 = 40
D3DFMT_P8 = 41
D3DFMT_L8 = 50
D3DFMT_A8L8 = 51
D3DFMT_A4L4 = 52
D3DFMT_V8U8 = 60
D3DFMT_L6V5U5 = 61
D3DFMT_X8L8V8U8 = 62
D3DFMT_Q8W8V8U8 = 63
D3DFMT_V16U16 = 64
D3DFMT_A2W10V10U10 = 67
D3DFMT_UYVY = make_four_cc("UYVY")
D3DFMT_R8G8_B8G8 = make_four_cc("RGBG")
D3DFMT_YUY2 = make_four_cc("YUY2")
D3DFMT_G8R8_G8B8 = make_four_cc("GRGB")
D3DFMT_DXT1 = make_four_cc("DXT1")
D3DFMT_DXT2 = make_four_cc("DXT2")
D3DFMT_DXT3 = make_four_cc("DXT3")
D3DFMT_DXT4 = make_four_cc("DXT4")
D3DFMT_DXT5 = make_four_cc("DXT5")
D3DFMT_SPORE_UNCOMPRESSED = 0x15000000
D3DFMT_D16_LOCKABLE = 70
D3DFMT_D32 = 71
D3DFMT_D15S1 = 73
D3DFMT_D24S8 = 75
D3DFMT_D24X8 = 77
D3DFMT_D24X4S4 = 79
D3DFMT_D16 = 80
D3DFMT_D32F_LOCKABLE = 82
D3DFMT_D24FS8 = 83
D3DFMT_D32_LOCKABLE = 84
D3DFMT_S8_LOCKABLE = 85
D3DFMT_L16 = 81
D3DFMT_VERTEXDATA = 100
D3DFMT_INDEX16 = 101
D3DFMT_INDEX32 = 102
D3DFMT_Q16W16V16U16 = 110
D3DFMT_MULTI2_ARGB8 = make_four_cc("MET1")
D3DFMT_R16F = 111
D3DFMT_G16R16F = 112
D3DFMT_A16B16G16R16F = 113
D3DFMT_R32F = 114
D3DFMT_G32R32F = 115
D3DFMT_A32B32G32R32F = 116
D3DFMT_CxV8U8 = 117
D3DFMT_A1 = 118
D3DFMT_A2B10G10R10_XR_BIAS = 119
D3DFMT_BINARYBUFFER = 199
D3DFMT_FORCE_DWORD = 0x7fffffff

# D3DZBUFFERTYPE
D3DZB_FALSE = 0
D3DZB_TRUE = 1
D3DZB_USEW = 2
D3DZB_FORCE_DWORD = 0x7fffffff

# D3DFILLMODE
D3DFILL_POINT = 1
D3DFILL_WIREFRAME = 2
D3DFILL_SOLID = 3
D3DFILL_FORCE_DWORD = 0x7fffffff

# D3DSHADEMODE
D3DSHADE_FLAT = 1
D3DSHADE_GOURAUD = 2
D3DSHADE_PHONG = 3
D3DSHADE_FORCE_DWORD = 0x7fffffff

# D3DBLEND
D3DBLEND_ZERO = 1
D3DBLEND_ONE = 2
D3DBLEND_SRCCOLOR = 3
D3DBLEND_INVSRCCOLOR = 4
D3DBLEND_SRCALPHA = 5
D3DBLEND_INVSRCALPHA = 6
D3DBLEND_DESTALPHA = 7
D3DBLEND_INVDESTALPHA = 8
D3DBLEND_DESTCOLOR = 9
D3DBLEND_INVDESTCOLOR = 10
D3DBLEND_SRCALPHASAT = 11
D3DBLEND_BOTHSRCALPHA = 12
D3DBLEND_BOTHINVSRCALPHA = 13
D3DBLEND_BLENDFACTOR = 14
D3DBLEND_INVBLENDFACTOR = 15
D3DBLEND_SRCCOLOR2 = 16
D3DBLEND_INVSRCCOLOR2 = 17
D3DBLEND_FORCE_DWORD = 0x7fffffff

# D3DCULL
D3DCULL_NONE = 1
D3DCULL_CW = 2
D3DCULL_CCW = 3
D3DCULL_FORCE_DWORD = 0x7fffffff

# D3DCMPFUNC
D3DCMP_NEVER = 1
D3DCMP_LESS = 2
D3DCMP_EQUAL = 3
D3DCMP_LESSEQUAL = 4
D3DCMP_GREATER = 5
D3DCMP_NOTEQUAL = 6
D3DCMP_GREATEREQUAL = 7
D3DCMP_ALWAYS = 8
D3DCMP_FORCE_DWORD = 0x7fffffff

# D3DFOGMODE
D3DFOG_NONE = 0
D3DFOG_EXP = 1
D3DFOG_EXP2 = 2
D3DFOG_LINEAR = 3
D3DFOG_FORCE_DWORD = 0x7fffffff

# D3DSTENCILOP
D3DSTENCILOP_KEEP = 1
D3DSTENCILOP_ZERO = 2
D3DSTENCILOP_REPLACE = 3
D3DSTENCILOP_INCRSAT = 4
D3DSTENCILOP_DECRSAT = 5
D3DSTENCILOP_INVERT = 6
D3DSTENCILOP_INCR = 7
D3DSTENCILOP_DECR = 8
D3DSTENCILOP_FORCE_DWORD = 0x7fffffff

# D3DMATERIALCOLORSOURCE
D3DMCS_MATERIAL = 0
D3DMCS_COLOR1 = 1
D3DMCS_COLOR2 = 2
D3DMCS_FORCE_DWORD = 0x7fffffff

# D3DVERTEXBLENDFLAGS
D3DVBF_DISABLE = 0
D3DVBF_1WEIGHTS = 1
D3DVBF_2WEIGHTS = 2
D3DVBF_3WEIGHTS = 3
D3DVBF_TWEENING = 255
D3DVBF_0WEIGHTS = 256

# D3DPATCHEDGESTYLE
D3DPATCHEDGE_DISCRETE = 0
D3DPATCHEDGE_CONTINUOUS = 1
D3DPATCHEDGE_FORCE_DWORD = 0x7fffffff

# D3DDEBUGMONITORTOKENS
D3DDMT_ENABLE = 0
D3DDMT_DISABLE = 1
D3DDMT_FORCE_DWORD = 0x7fffffff

# D3DDEGREETYPE
D3DDEGREE_LINEAR = 1
D3DDEGREE_QUADRATIC = 2
D3DDEGREE_CUBIC = 3
D3DDEGREE_QUINTIC = 5
D3DDEGREE_FORCE_DWORD = 0x7fffffff

# D3DBLENDOP
D3DBLENDOP_ADD = 1
D3DBLENDOP_SUBTRACT = 2
D3DBLENDOP_REVSUBTRACT = 3
D3DBLENDOP_MIN = 4
D3DBLENDOP_MAX = 5
D3DBLENDOP_FORCE_DWORD = 0x7fffffff

# D3DSAMPLERSTATETYPE
D3DSAMP_ADDRESSU = 1
D3DSAMP_ADDRESSV = 2
D3DSAMP_ADDRESSW = 3
D3DSAMP_BORDERCOLOR = 4
D3DSAMP_MAGFILTER = 5
D3DSAMP_MINFILTER = 6
D3DSAMP_MIPFILTER = 7
D3DSAMP_MIPMAPLODBIAS = 8
D3DSAMP_MAXMIPLEVEL = 9
D3DSAMP_MAXANISOTROPY = 10
D3DSAMP_SRGBTEXTURE = 11
D3DSAMP_ELEMENTINDEX = 12
D3DSAMP_DMAPOFFSET = 13
D3DSAMP_FORCE_DWORD = 0x7fffffff

# D3DTEXTUREOP
D3DTOP_DISABLE = 1
D3DTOP_SELECTARG1 = 2
D3DTOP_SELECTARG2 = 3
D3DTOP_MODULATE = 4
D3DTOP_MODULATE2X = 5
D3DTOP_MODULATE4X = 6
D3DTOP_ADD = 7
D3DTOP_ADDSIGNED = 8
D3DTOP_ADDSIGNED2X = 9
D3DTOP_SUBTRACT = 10
D3DTOP_ADDSMOOTH = 11
D3DTOP_BLENDDIFFUSEALPHA = 12
D3DTOP_BLENDTEXTUREALPHA = 13
D3DTOP_BLENDFACTORALPHA = 14
D3DTOP_BLENDTEXTUREALPHAPM = 15
D3DTOP_BLENDCURRENTALPHA = 16
D3DTOP_PREMODULATE = 17
D3DTOP_MODULATEALPHA_ADDCOLOR = 18
D3DTOP_MODULATECOLOR_ADDALPHA = 19
D3DTOP_MODULATEINVALPHA_ADDCOLOR = 20
D3DTOP_MODULATEINVCOLOR_ADDALPHA = 21
D3DTOP_BUMPENVMAP = 22
D3DTOP_BUMPENVMAPLUMINANCE = 23
D3DTOP_DOTPRODUCT3 = 24
D3DTOP_MULTIPLYADD = 25
D3DTOP_LERP = 26
D3DTOP_FORCE_DWORD = 0x7fffffff

# D3DTA
D3DTA_SELECTMASK = 0x0000000f  # mask for arg selector
D3DTA_DIFFUSE = 0x00000000  # select diffuse color (read only)
D3DTA_CURRENT = 0x00000001  # select stage destination register (read/write)
D3DTA_TEXTURE = 0x00000002  # select texture color (read only)
D3DTA_TFACTOR = 0x00000003  # select D3DRS_TEXTUREFACTOR (read only)
D3DTA_SPECULAR = 0x00000004  # select specular color (read only)
D3DTA_TEMP = 0x00000005  # select temporary register color (read/write)
D3DTA_CONSTANT = 0x00000006  # select texture stage constant
D3DTA_COMPLEMENT = 0x00000010  # take 1.0 - x (read modifier)
D3DTA_ALPHAREPLICATE = 0x00000020  # replicate alpha to color components (read modifier)

# D3DRENDERSTATETYPE
D3DRS_ZENABLE = 7
D3DRS_FILLMODE = 8
D3DRS_SHADEMODE = 9
D3DRS_ZWRITEENABLE = 14
D3DRS_ALPHATESTENABLE = 15
D3DRS_LASTPIXEL = 16
D3DRS_SRCBLEND = 19
D3DRS_DESTBLEND = 20
D3DRS_CULLMODE = 22
D3DRS_ZFUNC = 23
D3DRS_ALPHAREF = 24
D3DRS_ALPHAFUNC = 25
D3DRS_DITHERENABLE = 26
D3DRS_ALPHABLENDENABLE = 27
D3DRS_FOGENABLE = 28
D3DRS_SPECULARENABLE = 29
D3DRS_FOGCOLOR = 34
D3DRS_FOGTABLEMODE = 35
D3DRS_FOGSTART = 36
D3DRS_FOGEND = 37
D3DRS_FOGDENSITY = 38
D3DRS_RANGEFOGENABLE = 48
D3DRS_STENCILENABLE = 52
D3DRS_STENCILFAIL = 53
D3DRS_STENCILZFAIL = 54
D3DRS_STENCILPASS = 55
D3DRS_STENCILFUNC = 56
D3DRS_STENCILREF = 57
D3DRS_STENCILMASK = 58
D3DRS_STENCILWRITEMASK = 59
D3DRS_TEXTUREFACTOR = 60
D3DRS_WRAP0 = 128
D3DRS_WRAP1 = 129
D3DRS_WRAP2 = 130
D3DRS_WRAP3 = 131
D3DRS_WRAP4 = 132
D3DRS_WRAP5 = 133
D3DRS_WRAP6 = 134
D3DRS_WRAP7 = 135
D3DRS_CLIPPING = 136
D3DRS_LIGHTING = 137
D3DRS_AMBIENT = 139
D3DRS_FOGVERTEXMODE = 140
D3DRS_COLORVERTEX = 141
D3DRS_LOCALVIEWER = 142
D3DRS_NORMALIZENORMALS = 143
D3DRS_DIFFUSEMATERIALSOURCE = 145
D3DRS_SPECULARMATERIALSOURCE = 146
D3DRS_AMBIENTMATERIALSOURCE = 147
D3DRS_EMISSIVEMATERIALSOURCE = 148
D3DRS_VERTEXBLEND = 151
D3DRS_CLIPPLANEENABLE = 152
D3DRS_POINTSIZE = 154
D3DRS_POINTSIZE_MIN = 155
D3DRS_POINTSPRITEENABLE = 156
D3DRS_POINTSCALEENABLE = 157
D3DRS_POINTSCALE_A = 158
D3DRS_POINTSCALE_B = 159
D3DRS_POINTSCALE_C = 160
D3DRS_MULTISAMPLEANTIALIAS = 161
D3DRS_MULTISAMPLEMASK = 162
D3DRS_PATCHEDGESTYLE = 163
D3DRS_DEBUGMONITORTOKEN = 165
D3DRS_POINTSIZE_MAX = 166
D3DRS_INDEXEDVERTEXBLENDENABLE = 167
D3DRS_COLORWRITEENABLE = 168
D3DRS_TWEENFACTOR = 170
D3DRS_BLENDOP = 171
D3DRS_POSITIONDEGREE = 172
D3DRS_NORMALDEGREE = 173
D3DRS_SCISSORTESTENABLE = 174
D3DRS_SLOPESCALEDEPTHBIAS = 175
D3DRS_ANTIALIASEDLINEENABLE = 176
D3DRS_MINTESSELLATIONLEVEL = 178
D3DRS_MAXTESSELLATIONLEVEL = 179
D3DRS_ADAPTIVETESS_X = 180
D3DRS_ADAPTIVETESS_Y = 181
D3DRS_ADAPTIVETESS_Z = 182
D3DRS_ADAPTIVETESS_W = 183
D3DRS_ENABLEADAPTIVETESSELLATION = 184
D3DRS_TWOSIDEDSTENCILMODE = 185
D3DRS_CCW_STENCILFAIL = 186
D3DRS_CCW_STENCILZFAIL = 187
D3DRS_CCW_STENCILPASS = 188
D3DRS_CCW_STENCILFUNC = 189
D3DRS_COLORWRITEENABLE1 = 190
D3DRS_COLORWRITEENABLE2 = 191
D3DRS_COLORWRITEENABLE3 = 192
D3DRS_BLENDFACTOR = 193
D3DRS_SRGBWRITEENABLE = 194
D3DRS_DEPTHBIAS = 195
D3DRS_WRAP8 = 198
D3DRS_WRAP9 = 199
D3DRS_WRAP10 = 200
D3DRS_WRAP11 = 201
D3DRS_WRAP12 = 202
D3DRS_WRAP13 = 203
D3DRS_WRAP14 = 204
D3DRS_WRAP15 = 205
D3DRS_SEPARATEALPHABLENDENABLE = 206
D3DRS_SRCBLENDALPHA = 207
D3DRS_DESTBLENDALPHA = 208
D3DRS_BLENDOPALPHA = 209
D3DRS_FORCE_DWORD = 0x7fffffff

# D3DTEXTURESTAGESTATETYPE
D3DTSS_COLOROP = 1
D3DTSS_COLORARG1 = 2
D3DTSS_COLORARG2 = 3
D3DTSS_ALPHAOP = 4
D3DTSS_ALPHAARG1 = 5
D3DTSS_ALPHAARG2 = 6
D3DTSS_BUMPENVMAT00 = 7
D3DTSS_BUMPENVMAT01 = 8
D3DTSS_BUMPENVMAT10 = 9
D3DTSS_BUMPENVMAT11 = 10
D3DTSS_TEXCOORDINDEX = 11
D3DTSS_BUMPENVLSCALE = 22
D3DTSS_BUMPENVLOFFSET = 23
D3DTSS_TEXTURETRANSFORMFLAGS = 24
D3DTSS_COLORARG0 = 26
D3DTSS_ALPHAARG0 = 27
D3DTSS_RESULTARG = 28
D3DTSS_CONSTANT = 32
D3DTSS_FORCE_DWORD = 0x7fffffff

# RWDECLUSAGE
RWDECL_POSITION = 0
RWDECL_NORMAL = 2
RWDECL_COLOR0 = 3
RWDECL_COLOR1 = 5
RWDECL_TEXCOORD0 = 6
RWDECL_TEXCOORD1 = 7
RWDECL_TEXCOORD2 = 8
RWDECL_TEXCOORD3 = 9
RWDECL_BLENDINDICES = 14
RWDECL_BLENDWEIGHTS = 15
RWDECL_POINTSIZE = 16
RWDECL_POSITION2 = 17
RWDECL_NORMAL2 = 18
RWDECL_TANGENT = 19
RWDECL_BINORMAL = 20
RWDECL_FOG = 21
RWDECL_BLENDINDICES2 = 22
RWDECL_BLENDWEIGHTS2 = 23

RWDECLUSAGE_NAMES = {
    RWDECL_POSITION: "position",
    RWDECL_NORMAL: "normal",
    RWDECL_COLOR0: "color0",
    RWDECL_COLOR1: "color1",
    RWDECL_TEXCOORD0: "texcoord0",
    RWDECL_TEXCOORD1: "texcoord1",
    RWDECL_TEXCOORD2: "texcoord2",
    RWDECL_TEXCOORD3: "texcoord3",
    RWDECL_BLENDINDICES: "blendIndices",
    RWDECL_BLENDWEIGHTS: "blendWeights",
    RWDECL_POINTSIZE: "pointSize",
    RWDECL_POSITION2: "position2",
    RWDECL_NORMAL2: "normal2",
    RWDECL_TANGENT: "tangent",
    RWDECL_BINORMAL: "binormal",
    RWDECL_FOG: "fog",
    RWDECL_BLENDINDICES2: "blendIndices2",
    RWDECL_BLENDWEIGHTS2: "blendWeights2"
}

# RW_TYPE_CODE
RW_MODEL = 1
RW_TEXTURE = 0x04000000
RW_SPECIAL = 0xCAFED00D


class VertexElement:
    def __init__(self, stream=0, offset=0, element_type=0, method=0, usage=0, usage_index=0, rw_decl=0):
        self.stream = stream  # word
        self.offset = offset  # word
        self.type = element_type  # byte, D3DDECLTYPE
        self.method = method  # byte, D3DDECLMETHOD
        self.usage = usage  # byte, D3DDECLUSAGE
        self.usage_index = usage_index  # byte
        self.rw_decl = rw_decl  # RWDECLUSAGE

    def read(self, file: FileReader):
        self.stream, self.offset, self.type, self.method, self.usage, self.usage_index, self.rw_decl = \
            file.unpack('<hhbbbbi')

    def write(self, file: FileWriter):
        file.pack('<hhbbbbi',
                  self.stream, self.offset, self.type, self.method, self.usage, self.usage_index, self.rw_decl)


def create_rw_vertex_class(elements):
    return namedtuple('Vertex', [RWDECLUSAGE_NAMES[e.rw_decl] for e in elements])


def read_rw_vertex(elements, vertex_class, file: FileReader):
    values = []
    for element in elements:
        values.append(file.unpack(D3DDECLTYPE_FORMATS[element.type]))
    return vertex_class(*values)


def write_rw_vertex(elements, vertex, file: FileWriter):
    for i, element in enumerate(elements):
        file.pack(D3DDECLTYPE_FORMATS[element.type], *vertex[i])


def unpack_normal(value):
    return (value - 127.5) / 127.5


def unpack_normals(values):
    """
    Converts a tuple of 0-255 values into a tuple of 3 0.0-1.0 values, that can be used by Blender
    :param values:
    :return:
    """
    return unpack_normal(values[0]), unpack_normal(values[1]), unpack_normal(values[2])
